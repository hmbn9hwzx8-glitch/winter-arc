<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Winter Arc</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#111">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<style>
html, body { overscroll-behavior:none; touch-action:manipulation; -webkit-user-select:none; -webkit-touch-callout:none; -webkit-text-size-adjust:100%; }
*{ touch-action:manipulation; }
body{ font-family:-apple-system,system-ui; background:#000; color:#eee; padding:16px; padding-top: calc(60px + env(safe-area-inset-top)); }

.task-card{background:#c9b7e2;color:#111;border-radius:18px;padding:14px 16px;margin:12px 0;display:flex;justify-content:space-between;align-items:center;box-shadow:0 6px 16px rgba(0,0,0,.25);}
.task-card.done{opacity:.45;text-decoration:line-through}
.task-text{font-size:15px;font-weight:500}

.check-btn{width:36px;height:36px;border-radius:50%;background:#fff;position:relative;display:flex;align-items:center;justify-content:center}
.plus-h,.plus-v{position:absolute;background:#c9b7e2;border-radius:2px}
.plus-h{width:16px;height:3px}
.plus-v{width:3px;height:16px}

.top-bar{position:fixed;top:env(safe-area-inset-top);left:0;width:100%;height:60px;display:flex;align-items:center;justify-content:center;z-index:3000}
.top-title{font-size:18px;font-weight:600;color:#fff}

.top-btn{position:absolute;color:#c9b7e2;font-size:26px;cursor:pointer}
.hamburger{left:16px}
.add-btn-top{right:12px;font-weight:300}

.hamburger span{display:block;width:20px;height:2px;background:#c9b7e2;border-radius:2px;margin:3px 0}

.plus-icon{position:relative;width:16px;height:16px}
.plus-icon::before,.plus-icon::after{content:"";position:absolute;background:#c9b7e2;border-radius:2px}
.plus-icon::before{width:16px;height:2.5px;top:50%;transform:translateY(-50%)}
.plus-icon::after{width:2.5px;height:16px;left:50%;transform:translateX(-50%)}

#statsBar{
position:absolute;
bottom:4px;
display:flex;
align-items:center;
gap:10px;
font-size:12px;
color:#c9b7e2;
}

#xpBar{
width:80px;
height:6px;
background:#333;
border-radius:10px;
overflow:hidden;
}

#xpFill{
height:100%;
width:0%;
background:#c9b7e2;
transition:.3s;
}

#calendarWrapper{margin-top:8px;padding:8px 0 14px;overflow:hidden;position:relative}
#calendarTrack{display:flex;gap:22px;padding:0 50vw;overflow-x:auto;scroll-snap-type:x mandatory}
.calendar-day{min-width:48px;text-align:center;color:#aaa;scroll-snap-align:center}
.calendar-day.today{color:#c9b7e2}
.calendar-day.selected{color:#fff}

#calendarBubble{position:absolute;top:0;width:64px;height:72px;border-radius:32px;background:#c9b7e2;pointer-events:none;transition:.35s;z-index:-1}

.empty-state{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;color:#bbb;opacity:0;transition:.3s}
.empty-state.show{opacity:1}

.panel-inner{background:#0b0b0b;border-radius:22px;padding:18px}
.panel-handle{width:36px;height:5px;background:#444;border-radius:10px;margin:0 auto 12px}
</style>
</head>
<body>

<div class="top-bar">
  <div class="top-btn hamburger" onclick="openMenu()">
    <span></span><span></span><span></span>
  </div>

  <div class="top-title">Winter Arc</div>

  <div id="statsBar">
    <div id="streakText">üî• 0</div>
    <div id="xpBar"><div id="xpFill"></div></div>
    <div id="levelText">Lv 1</div>
  </div>

  <div class="top-btn add-btn-top" onclick="openCreatePanel()">
    <span class="plus-icon"></span>
  </div>
</div>

<div id="calendarWrapper">
  <div id="calendarTrack"></div>
  <div id="calendarBubble"></div>
</div>

<div id="emptyState" class="empty-state">
  <div style="font-size:64px">üìÅ</div>
  <p>Hen√ºz eklenen bir hedef yok</p>
  <div onclick="openCreatePanel()">+ Yeni Hedef Olu≈ütur</div>
</div>

<div id="goalsContainer"></div>

<div id="createPanel" style="position:fixed;left:0;right:0;bottom:-100%;height:85%;background:#111;border-radius:20px;transition:.3s;padding:16px;z-index:2000">
<div class="panel-inner">
<div class="panel-handle"></div>
<h3>Yeni Hedef</h3>
<input id="goalInput" placeholder="Hedef adƒ±" style="width:100%;padding:12px;border-radius:12px;border:none">
<button onclick="addGoal()" style="margin-top:12px;width:100%">Kaydet</button>
<button onclick="closeCreatePanel()" style="margin-top:8px;width:100%">ƒ∞ptal</button>
</div>
</div>

<script>
let goals = JSON.parse(localStorage.getItem("goals_v2")||"[]");
let selectedDate = localStorage.getItem("selectedDate")||todayStr();

function todayStr(){return new Date().toISOString().slice(0,10)}
function save(){localStorage.setItem("goals_v2",JSON.stringify(goals))}

window.onload=()=>{buildCalendar();renderGoals();updateStats();checkEmptyState()}

function addGoal(){
const t=document.getElementById("goalInput").value.trim();
if(!t)return;
goals.unshift({id:"g_"+Date.now(),title:t,createdAt:todayStr(),checks:{}});
save();renderGoals();updateStats();checkEmptyState();closeCreatePanel();
document.getElementById("goalInput").value="";
}

function toggleGoal(id){
const g=goals.find(x=>x.id===id);
if(!g)return;
if(g.checks[selectedDate]) delete g.checks[selectedDate];
else g.checks[selectedDate]=true;
save();renderGoals();updateStats();
}

function renderGoals(){
const c=document.getElementById("goalsContainer");
c.innerHTML="";
goals.forEach(g=>{
const done=!!g.checks[selectedDate];
const d=document.createElement("div");
d.className="task-card"+(done?" done":"");
d.innerHTML=`<div class="task-text">${g.title}</div>
<div class="check-btn" onclick="toggleGoal('${g.id}')">
<span class="plus-h"></span><span class="plus-v"></span></div>`;
c.appendChild(d);
});
}

function checkEmptyState(){
const e=document.getElementById("emptyState");
if(goals.length){e.classList.remove("show");}
else{e.classList.add("show");}
}

function calcStats(){
let totalXP=0;
const days={};

goals.forEach(g=>{
for(const d in g.checks){
totalXP+=10;
days[d]=(days[d]||0)+1;
}
});

let streak=0;
let cur=new Date();
while(true){
const s=cur.toISOString().slice(0,10);
if(days[s]) streak++;
else break;
cur.setDate(cur.getDate()-1);
}

let level=1,need=100;
let xp=totalXP;
while(xp>=need){xp-=need;level++;need+=100;}

return {streak,level,xp,need,totalXP};
}

function updateStats(){
const s=calcStats();
document.getElementById("streakText").textContent=`üî• ${s.streak}`;
document.getElementById("levelText").textContent=`Lv ${s.level}`;
document.getElementById("xpFill").style.width=Math.min(100,(s.xp/s.need*100))+"%";
}

function openCreatePanel(){document.getElementById("createPanel").style.bottom="0"}
function closeCreatePanel(){document.getElementById("createPanel").style.bottom="-100%"}
function openMenu(){alert("Menu later üòÑ")}

const daysShort=["Paz","Pzt","Sal","√áar","Per","Cum","Cts"];
let selectedIndex=0,todayIndex=0;

function buildCalendar(){
const track=document.getElementById("calendarTrack");
track.innerHTML="";
const today=new Date();
const start=new Date();start.setDate(today.getDate()-180);

for(let i=0;i<365;i++){
const d=new Date(start);d.setDate(start.getDate()+i);
const ds=d.toISOString().slice(0,10);
const div=document.createElement("div");
div.className="calendar-day";
div.innerHTML=`<div>${daysShort[d.getDay()]}</div><div>${d.getDate()}</div>`;
if(ds===todayStr()){div.classList.add("today");todayIndex=i;}
if(ds===selectedDate){div.classList.add("selected");selectedIndex=i;}
div.onclick=()=>selectDay(i,ds);
track.appendChild(div);
}
requestAnimationFrame(()=>centerOnIndex(selectedIndex,false));
}

function selectDay(i,ds){
selectedDate=ds;
localStorage.setItem("selectedDate",ds);
document.querySelectorAll(".calendar-day").forEach(d=>d.classList.remove("selected"));
document.querySelectorAll(".calendar-day")[i].classList.add("selected");
selectedIndex=i;
centerOnIndex(i,true);
renderGoals();
}

function centerOnIndex(i,a){
const t=document.getElementById("calendarTrack");
const it=t.children[i];
const b=document.getElementById("calendarBubble");
const x=it.offsetLeft+it.offsetWidth/2-t.clientWidth/2;
t.scrollTo({left:x,behavior:a?"smooth":"auto"});
b.style.transform=`translateX(${it.offsetLeft+it.offsetWidth/2-b.offsetWidth/2}px)`;
}
</script>

</body>
</html>
